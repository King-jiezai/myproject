







<style scoped>

    .mos-left {
        float: left;
        font-size: 15px;
        padding-left: 49px;
    }
    .mos-left p {
        width: 100px;
        line-height: 38px;
        text-align: right;
        margin-right: 10px;
        float: left;
    }
    .mos-left input {
        width: 120px;
        height: 38px;
        border-radius: 4px;
        border: 1px solid #d5d5d5;
        padding: 0 10px;
        outline: medium;
        float: left;
    }
    .paddword {
        height: 38px;
        position: relative;
        margin-bottom: 15px;
    }
    .paddword .ord {
        position: absolute;
        top: 6px;
        left: 330px;
    }
    .paddword input {
        width: 250px;
        padding: 0 36px 0 10px;
        outline: medium;
    }
    .mos-left .secur {
        font-size: 12px;
        padding-bottom: 15px;
        margin-left: 193px;
    }
    .secur span {
        color: #fff;
        padding: 3px 10px;
        background: #ccc;
        margin-right: 5px;
    }
    .secur span:last-child {
        margin-right: 0;
    }
    .source {
        height: 38px;
        text-align: center;
        line-height: 38px;
        margin-bottom: 15px;
        position: relative;
    }
    .source .fsp {
        width: 250px;
        height: 38px;
        border-radius: 4px;
        border: 1px solid #d5d5d5;
        padding: 0 10px;
        outline: medium;
        cursor: pointer;
        float: left;
    }
    .phone {
        height: 38px;
        margin-bottom: 15px;
        position: relative;
    }
    .gg {
        padding-right: 5px;
    }
    .codes {
        height: 38px;
        margin-bottom: 15px;
    }
    .codes .ss {
        width: 120px;
        height: 38px;
        text-align: center;
        font-size: 14px;
        line-height: 38px;
        border-radius: 4px;
        background: #eee;
        border: 1px solid #ccc;
        margin-left: 10px;
        display: block;
        float: left;
        cursor: pointer;
    }
    .os {
        width: 120px;
        height: 38px;
        text-align: center;
        font-size: 14px;
        line-height: 38px;
        border-radius: 4px;
        background: #eee;
        border: 1px solid #ccc;
        margin-right: 10px;
        float: left;
        display: block;
        cursor: pointer;
    }
    .nex {
        width: 250px;
        height: 34px;
        text-align: center;
        line-height: 34px;
        color: #fff;
        border-radius: 4px;
        background: #e60012;
        margin: 46px 0 0 110px;
    }
    .mos-right {
        width: 196px;
        overflow: hidden;
        text-align: center;
        float: right;
        margin-right: 49px;
    }
    .fon-top {
        width: 187px;
        height: 50px;
        line-height: 50px;
        font-size: 18px;
        color: #5a5a5a;
    }
    .fon-top .nn {
        color: #5f97d8;
    }
    .fon-top img {
        position: relative;
        top: 4px;
    }
    .fon-top .span {
        float: left;
    }
    .mos-left .xin {
        color: #e60012;
        padding: 0 5px;
        position: relative;
        top: 3px;
    }
    .po p {
        font-size: 14px;
        color: #999;
    }
    .fff-right {
        float: left;
        font-size: 14px;
        color: #e60012;
        margin: 2px 0 0 10px;
    }
    .fff-right img {
        float: left;
        position: relative;
        top: 11px;
        z-index: 1;
    }
    .fff-right .right-right {
        float: left;
        padding: 5px;
        border: 1px solid #fac5c5;
        border-radius: 4px;
        background: #ffebeb;
        margin-left: -1px;
        position: relative;
        z-index: 0;
    }
    .fff-right .x {
        float: left;
        width: 15px;
        height: 15px;
        color: #fff;
        font-size: 12px;
        text-align: center;
        line-height: 15px;
        border-radius: 50%;
        background: #e60012;
        margin: 3px 5px 0 0;
    }
    .ffo-right {
        float: left;
        font-size: 14px;
        color: #666;
        margin: 2px 0 0 10px;
    }
    .ffo-right img {
        float: left;
        position: relative;
        top: 11px;
        z-index: 1;
    }
    .ffo-right .rights-right {
        float: left;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: #fff;
        margin-left: -1px;
        position: relative;
        z-index: 0;
    }
    .ffo-right .d {
        float: left;
        width: 15px;
        height: 15px;
        color: #fff;
        font-size: 12px;
        text-align: center;
        line-height: 15px;
        border-radius: 50%;
        background: #FAAD34;
        margin: 3px 5px 0 0;
    }
    .imm {
        margin: 11px 0 0 10px;
    }
    .source-down {
        width: 250px;
        overflow: hidden;
        border: 1px solid #d5d5d5;
        background: #fff;
        padding: 5px 0;
        position: absolute;
        left: 110px;
        top: 40px;
        z-index: 999;
    }
    .source-down p {
        width: 250px;
        text-align: center;
        cursor: pointer;
        margin: 0;
    }
    .source-down p:hover {
        color: #fff;
        background: #e60012;
    }
    .fsl-down {
        width: 120px;
        overflow: hidden;
        border: 1px solid #d5d5d5;
        background: #fff;
        position: absolute;
        left: 110px;
        top: 40px;
        z-index: 998;
    }
    .fsl-down p {
        width: 120px;
        text-align: center;
        cursor: pointer;
        margin: 0;
    }
    .fsl-down p:hover {
        color: #fff;
        background: #e60012;
    }
    .posit {
        width: 251px;
        position: absolute;
        top: 0;
        left: 360px;
    }
    .posit .p {
        padding-left: 20px;
    }
    .ws {
        margin-bottom: 15px;
    }
    .customer {
        height: 38px;
        overflow: hidden;
    }
    .customer .wu {
        font-size: 12px;
        line-height: 38px;
    }
    .cusname {
        overflow: hidden;
        line-height: 25px;
        font-size: 12px;
        margin: 5px 0 0 100px;
    }
    .cusname span {
        float: left;
        padding: 0 10px;
    }
    .cusname input {
        width: 99px;
        height: 25px;
        padding: 0 6px;
    }
    .oo-oo {
        margin-top: 30px;
    }
    .sens {
        pointer-events: none;
        cursor: default;
    }

</style>

<template>

    <div class="regs">

        <div class="mos-left">
            <div class="source">
                <p><span class="xin">*</span>来源渠道</p>

                <div class="fsp" @click.stop='downs'>
                    <span class="gg">{{other}}</span>
                    <Icon type="arrow-down-b"></Icon>
                </div>

                <div class="source-down" v-show='down'>
                    <p v-for='(item, index) in pin' @click='lis(index)'>{{item.fon}}</p>
                </div>
            </div>

            <div class="paddword ws">
                <p><span class="xin">*</span>企业名称</p>
                <input type="text" v-model='compay' @blur='comm' @focus='comms'>

                <div class="ffo-right posit" v-show='cona'>
                    <img src="../../../../static/images/reg/sj1.png">
                    <div class="rights-right">
                        <div>
                            <div class="d">！</div>
                            <span>请输入企业或政府单位名称，限</span>
                        </div>
                        <div class="p">2-32个字以内</div>
                    </div>
                </div>

                <div class="fff-right" v-show='cono'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>请输入企业或政府单位名称</span>
                    </div>
                </div>
            </div>

            <div class="phone">
                <p><span class="xin">*</span>手机号</p>
                <span class="os" @click.stop='main'>
                    <span class="gg">{{Mainland}}</span>
                    <Icon type="arrow-down-b"></Icon>
                </span>
                <input type="text" v-model='phone' @blur='blur'>

                <div class="fff-right" v-show='blurs'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>请输入手机号码</span>
                    </div>
                </div>

                <div class="fff-right" v-show='bluro'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>手机号码格式不正确</span>
                    </div>
                </div>

                <div class="fff-right" v-show='blurd'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>手机号码已存在</span>
                    </div>
                </div>

                <img class="imm" src="../../../../static/images/reg/dui.png" v-show='tu'>

               <!--  <div class="fsl-down" v-show='region'>
                    <p v-for='(item, index) in pos' @click='list(index)'>{{item.fon}}</p>
                </div> -->
            </div>

            <div class="codes">
                <p><span class="xin">*</span>短信验证码</p>
                <input type="text" v-model='des' @click='codes' @blur='yzm'>
                <span class="ss" :class="{'sens': pro}" @click='pcod'>
                    <span v-show='obn'>获取短信验证码</span>
                    <span v-show='sen'>{{this.second}}s</span>
                </span>

                <div class="fff-right" v-show='deo'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>请输入您收到的短信验证码</span>
                    </div>
                </div>

                <div class="fff-right" v-show='deos'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>请输入四位纯数字验证码</span>
                    </div>
                </div>

                <div class="fff-right" v-show='ood'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>验证码输入错误</span>
                    </div>
                </div>
            </div>

            <div class="paddword">
                <p><span class="xin">*</span>密码</p>
                <input type="password" v-model='padd' @blur='mm' @focus='mmm'>
                <img class="ord" src="../../../../static/images/reg/mm.png">

                <div class="ffo-right posit" v-show='pada'>
                    <img src="../../../../static/images/reg/sj1.png">
                    <div class="rights-right">
                        <div>
                            <div class="d">！</div>
                            <span>6-16字符，可由数字、字母、特殊</span>
                        </div>
                        <div class="p">符号组成，字母区分大小写</div>
                    </div>
                </div>

                <div class="fff-right" v-show='padb'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>密码必须包含长度为8-16位的字母和数字</span>
                    </div>
                </div>

                <div class="fff-right" v-show='padc'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>请设置您的密码</span>
                    </div>
                </div>
            </div>

            <!-- <div class="secur">安全程度：<span>弱</span><span>中</span><span>强</span></div> -->

            <div class="paddword">
                <p><span class="xin">*</span>确认密码</p>
                <input type="password" v-model='padds' @blur='mms' @focus='mmms'>
                <img class="ord" src="../../../../static/images/reg/mm.png">

                <div class="ffo-right" v-show='padda'>
                    <img src="../../../../static/images/reg/sj1.png">
                    <div class="rights-right">
                        <div class="d">！</div>
                        <span>请再次输入确认密码</span>
                    </div>
                </div>

                <div class="fff-right" v-show='paddb'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>请输入确认密码</span>
                    </div>
                </div>

                <div class="fff-right" v-show='paddc'>
                    <img src="../../../../static/images/reg/sj2.png">
                    <div class="right-right">
                        <div class="x">x</div>
                        <span>两次密码输入不一致</span>
                    </div>
                </div>
            </div>

            <div class="customer">
                <p>客户经理</p>

                <RadioGroup v-model="lows" @on-change='chon' size='large'>
                    <Radio label="apple" size='large'>
                        <span>无</span>
                    </Radio>
                    <Radio label="android" size='large'>
                        <span>有</span>
                    </Radio>
                </RadioGroup>

                <span class="wu">若有联系过广租客户经理请选择“有”</span>
            </div>

            <div class="cusname" v-show='hids'>
                <span>昵称</span>
                <input type="text" v-model='cusn'>
            </div>

            <div class="nex" @click='next'>注册</div>
        </div>

        <div class="mos-right">
            <div class="fon-top">
                <p class="span">已有账号，</p>

                <div>
                    <router-link to='/login' target='_blank'>
                        <span class="nn">马上登录</span>
                        <img src="../../../../static/images/reg/tu.png">
                    </router-link>
                </div>
            </div>

            <div class="oo-oo">
                <img src="../../../../static/images/reg/zi.png">
            </div>

            <div class="po">
                <img src="../../../../static/images/wechat-2.png">
                <p>扫一扫，关注公众号</p>
            </div>
        </div>

    </div>

</template>

<script>

    import { Icon, RadioGroup, Radio } from 'iview'

    import { mapState } from 'vuex'

    export default {

        components : {

            Icon      ,
            RadioGroup,
            Radio     ,

        },

        data () {

            return {

                blurd: false,

                blurs: false,

                bluro: false,

                phone: '',

                tu   : false,

                des  : '',

                deo  : false,

                deos : false,

                ood  : false,

                padb : false,

                padc : false,

                pada : false,

                padd : '',

                padda: false,

                paddb: false,

                paddc: false,

                padds: '',

                down : false,

                other: '其它广告',

                compay : '',

                cona   : false,

                cono   : false,

                pin  : [{
                    fon : '其它广告'
                },{
                    fon : '地推活动'
                },{
                    fon : '展会了解'
                },{
                    fon : '业务联系'
                },{
                    fon : '百度推广'
                },{
                    fon : '朋友推荐'
                }],

                Mainland : '中国大陆86',

                region   : false,

                pos      : [{
                    fon : '中国大陆86'
                },{
                    fon : '香港'
                },{
                    fon : '澳门'
                }],

                hids : false,

                lows : 'apple',

                cusn : '',

                obn    : true,

                sen    : false,

                second : '',

                pro    : false

            }
            
        },

        computed : {

             ...mapState([

                'hid'

            ])

        },

        watch : {

            hid () {

                this.down = false

                this.region = false
                
            }

        },

        methods : {

            //获取短信验证码
            async pcod () {

                let reo = await this.$api.checkPhone({
                    phone:this.phone
                })

                this.blur()

                if (this.tu == true) {

                    let res = await this.$api.phoneCode({
                        phone:this.phone
                    })

                    this.second = 60

                    this.pro = true

                    this.obn = false

                    this.sen = true

                    let tim = setInterval(()=> {

                        this.second--

                        if (this.second < 0) {

                            this.pro = false

                            this.obn = true

                            this.sen = false

                            clearInterval(tim)

                        }

                    }, 1000)

                }

            },

            //企业名称输入框失去焦点
            comm () {

                if (this.compay == '') {

                    this.cona = false

                    this.cono = true

                } else {

                    this.cona = false

                    this.cono = false

                }

            },

            //企业名称输入框获取焦点
            comms () {

                this.cona = true

                this.cono = false

            },

            //来源渠道下拉框显示隐藏
            downs () {

                this.down = !this.down

            },

            //来源渠道选择
            lis (index) {

                this.other = this.pin[index].fon

                this.down = false

            },

            //区号下拉框显示隐藏
            main () {

                this.region = !this.region

            },

            //区号选择
            list (index) {

                this.Mainland = this.pos[index].fon

                this.region = false

            },

            //手机号输入框失去焦点
            async blur () {

                let blur = /^((1[3,5,8][0-9])|(14[5,7])|(17[0,6,7,8])|(19[7]))\d{8}$/

                if (this.phone == '') {

                    this.blurs = true

                    this.bluro = false

                    this.blurd = false

                    this.tu = false

                } else if (!blur.test(this.phone)) {

                    this.bluro = true

                    this.blurs = false

                    this.blurd = false

                    this.tu = false

                }

                if (blur.test(this.phone)) {

                    this.blurs = false

                    this.bluro = false

                    let reo = await this.$api.checkPhone({
                        phone:this.phone
                    })

                    if (reo.data.status == 0) {

                        this.blurd = true

                        this.tu = false

                    } else {

                        this.blurd = false

                        this.tu = true

                    }

                }

            },

            codes () {

                // this.code = true

            },

            //短信验证码输入框失去焦点
            yzm () {

                let patrn = /^[0-9]*$/

                if (patrn.test(this.des) && this.des.length == 4) {

                    this.deo = false

                    this.deos = false

                    this.ood = false

                } else {

                    this.deo = false

                    this.deos = true

                    this.ood = false

                }

                if (this.des == '') {

                    this.deo = true

                    this.deos = false

                    this.ood = false

                }

            },

            //密码输入框失去焦点
            mm () {

                let pat = /^(?=.*[0-9])(?=.*[a-zA-Z])(.{6,16})$/

                if (this.padd == '') {

                    this.pada = false

                    this.padb = false

                    this.padc = true

                } else if (pat.test(this.padd) && 6 <= this.padd.length <= 16) {

                    this.pada = false

                    this.padb = false

                    this.padc = false

                } else {

                    this.pada = false

                    this.padb = true

                    this.padc = false

                }

                if (!pat.test(this.padd) && this.padd != '') {

                    this.pada = false

                    this.padb = true

                    this.padc = false

                }

                if (this.padds != this.padd && this.padds != '') {

                    this.padda = false

                    this.paddb = false

                    this.paddc = true

                }

            },

            //密码输入框获取焦点
            mmm () {

                this.padc = false

                this.pada = true

                this.padb = false

            },

            //确认密码输入框失去焦点
            mms () {

                if (this.padds == '') {

                    this.padda = false

                    this.paddb = true

                }

                if (this.padds != this.padd && this.padds != '') {


                    this.padda = false

                    this.paddb = false

                    this.paddc = true

                }

                if (this.padds == this.padd) {

                    this.padda = false

                }

            },

            //确认密码输入框获取焦点
            mmms () {

                this.padda = true

                this.paddb = false

                this.paddc = false

            },

            //选择客户经理
            chon (index) {

                this.lows = index

                if (index == 'android') {

                    this.hids = true

                } else {

                    this.hids = false

                }

            },

            //企业注册
            async next () {

                this.code = true

                this.blur()

                this.yzm()

                this.mm()

                this.mms()

                this.comm()

                let loname = ''

                let cusname = ''

                if (this.lows == 'apple') {
                    loname = '无'
                }
                if (this.lows == 'android') {
                    loname = '有'
                }
                if (loname == '无') {
                    cusname = ''
                }
                if (loname == '有') {
                    cusname = this.cusn
                }

                if (this.cona == false && this.cono == false && this.tu == true 
                    && this.deo == false && this.deos == false && this.pada == false 
                    && this.padb == false && this.padc == false && this.padda == false 
                    && this.paddb == false && this.paddc == false) {

                    if (cusname == '' || cusname != '') {

                        let reo = await this.$api.checkRegister({
                            phone:this.phone,
                            phoneCode:this.des,
                        })
                        
                        if (reo.data.status == 0) {

                            this.ood = true

                        }

                        if (reo.data.status == 1) {

                            let res = await this.$api.register({
                                type:2,
                                source:this.other,
                                username:this.compay,
                                phone:this.phone,
                                phoneCode:this.des,
                                password:this.padd,
                                customerManager:cusname
                            })

                            this.$router.push('/login')

                        }

                    }

                }

            }

        },

        created () {

        },

        mounted () {

        }

    }

</script>
