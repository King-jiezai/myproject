







<style scoped>

    .news {
        width: 700px;
        overflow: hidden;
        background: #EFEDEE;
        padding-bottom: 5px;
    }
    .news .p1 {
        line-height: 35px;
        color: #034C7F;
        font-size: 15px;
        padding-left: 25px;
        float: left;
    }
    .news .p2 {
        float: right;
        font-size: 26px;
        line-height: 35px;
        margin-right: 15px;
        cursor: pointer;
    }
    .news-bottom {
        width: 690px;
        overflow: hidden;
        font-size: 15px;
        background: #fff;
        margin: 0 auto;
        padding: 15px 0;
        position: relative;
    }
    .fsl-bos {
        margin-bottom: 15px;
        overflow: hidden;
        position: relative;
        padding: 0 45px;
    }
    .left-o {
        float: left;
        width: 100px;
        text-align: right;
        margin-right: 15px;
    }
    .nns {
        color: #e60012;
    }
    .left-left {
        float: left;
        width: 100px;
        text-align: right;
        line-height: 30px;
        margin-right: 15px;
    }
    .o-red {
        color: #e60012;
        position: relative;
        top: 2px;
        margin: 0 5px;
    }
    .reg-lu {
        position: relative;
    }
    .reg-lu div {
        height: 116px;
        position: absolute;
        top: 30px;
        left: 115px;
    }
    .reg-lu .sp1 {
        width: 96px;
        height: 30px;
        text-align: center;
        line-height: 30px;
        float: left;
        border: 1px solid #ccc;
        cursor: pointer;
    }
    .reg-lu .sp2 {
        margin-right: 5px;
    }
    .reg-lus {
        float: left;
        position: relative;
    }
    .reg-san {
        float: left;
        width: 274px;
        height: 30px;
        line-height: 30px;
        border-top : 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        border-left : 1px solid #ccc;
        margin-left: 10px;
        padding: 0 10px;
        cursor: pointer;
        position: relative;   
    }
    .reg-ban {   
        width: 100px;
        height: 80px;
        border: 1px solid #ccc;
        left: 266px;
        position: absolute;
        top: 82px;
        background: #fff;
        z-index: 999;
        overflow-y: auto;
    }
    .reg-bans {    
        width: 100px;
        height: 80px;
        border: 1px solid #ccc;
        position: absolute;
        top: 82px;
        background: #fff;
        z-index: 999;
        left: 363px;
        overflow-y: auto;
    }
    .reg-banss {    
        width: 100px;
        height: 80px;
        border: 1px solid #ccc;
        position: absolute;
        top: 82px;
        background: #fff;
        z-index: 999;
        left: 460px;
        overflow-y: auto;
    }
    .reg-san p {
        float: left;
    }
    .reg-ban div {
        text-align: center;
        line-height: 25px;
        font-size: 13px;
        cursor: pointer;
    }
    .reg-bans div {
        text-align: center;
        line-height: 25px;
        font-size: 13px;
        cursor: pointer;
    }
    .reg-banss div {
        text-align: center;
        line-height: 25px;
        font-size: 13px;
        cursor: pointer;
    }
    .reg-ban div:hover {
        color: #fff;
        background: #e60012;
    }
    .reg-bans div:hover {
        color: #fff;
        background: #e60012;
    }
    .reg-banss div:hover {
        color: #fff;
        background: #e60012;
    }
    .circ {
        width: 20px;
        height: 30px;
        float: left;
        border-top : 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        border-right : 1px solid #ccc;
    }
    .circ .sps {       
        margin: 5px;
    }
    .circ .circs {    
        margin: 5px;
        color: #e60012;
    }
    .oox {
        float: right;
        font-size: 12px;
        margin-right: 10px;
        margin-top: 7px;
        color: #ccc;
    }
    .fog {
        width: 98px;
        border: 1px solid #ccc;
        background: #fff;
        position: absolute;
        top: 85px;
        left: 160px;
        z-index: 999;
    }
    .fog p {
        text-align: center;
        line-height: 35px;
        cursor: pointer;
    }
    .fog p:hover {
        color: #fff;
        background: #e60012;
    }
    .trea {
        width: 400px;
        height: 70px;
        font-size: 12px;
        background: #f5f5f5;
        border: 1px solid #ccc;
        padding: 5px 7px;
        resize: none;
        outline: medium;
    }
    .ins {
        width: 220px;
        height: 30px;
        font-size: 12px;
        padding: 0 10px;
        border: 1px solid #ccc;
        outline: medium;
    }
    .ina {
        width: 180px;
        height: 30px;
        font-size: 12px;
        padding: 0 10px;
        border: 1px solid #ccc;
        outline: medium;
        float: left;
    }
    .phones {
        float: left;
    }
    .inb {
        width: 50px;
        height: 30px;
        font-size: 12px;
        padding: 0 10px;
        border: 1px solid #ccc;
        outline: medium;
    }
    .inc {
        width: 100px;
        height: 30px;
        font-size: 12px;
        padding: 0 10px;
        border: 1px solid #ccc;
        outline: medium;
    }
    .pps {
        margin: 0 10px;
    }
    .mor {
        font-size: 13px;
        margin-left: 115px;
        position: relative;
        top: 1px;
    }
    .pre {
        width: 80px;
        height: 35px;
        color: #fff;
        text-align: center;
        line-height: 35px;
        border-radius: 5px;
        background: #e60012;
        margin: 15px 0 0 115px;
        cursor: pointer;
    }
    .foor-bottom {
        width: 644px;
        height: 149px;
        overflow-y: auto;
        overflow-x: hidden;
        margin: 30px auto 0;
    }
    .fs-fs {
        width: 644px;
        height: 34px;
        line-height: 34px;
        background: #efeeee;
        border: 1px solid #ccc;
        padding: 0 15px;
    }
    .fs-fs p {
        width: 90px;
        float: left;
    }
    .fs-fs p:nth-child(2) {
        width: 126px;
    }
    .fs-fs p:nth-child(3) {
        width: 126px;
    }
    .fs-fs p:last-child {
        width: 90px;
        text-align: center;
    }
    .fs-os {
        width: 644px;
        font-size: 12px;
        overflow: hidden;
        padding: 10px 15px;
        border: 1px solid #ccc;
        border-top: 0;
    }
    .fs-os p {
        width: 90px;
        float: left;
    }
    .fs-os .phs {
        width: 90px;
        float: left;
    }
    .fs-os p:nth-child(2) {
        width: 127px;
        padding-right: 20px;
    }
    .fs-os p:nth-child(3) {
        width: 127px;
        padding-right: 20px;
    }
    .fs-os p:last-child {
        width: 88px;
        text-align: center;
        float: left;
    }
    .fs-os p:last-child span {
        color: #0891fb;
        cursor: pointer;
    }

</style>

<template>

    <div class="news">
        <div>
            <p class="p1">管理地址</p>
            <p class="p2" @click='errs'>×</p>
        </div>

        <div class="news-bottom">
            <div class="fsl-bos">
                <p class="left-o nns">修改收货地址</p>
                <span>电话号码和手机号选填一项，其余为必填项</span>
            </div>

            <div class="fsl-bos">
                <p class="left-left"><span class="o-red">*</span>所在地区</p>
                <div class="reg-lu">
                    <p class="sp1" @click='fogs'><span class="sp2">{{guo}}</span><Icon type="arrow-down-b"></Icon></p>
                </div>
                <div class="reg-lus" @mouseenter="mou" @mouseleave="les">
                    <div class="reg-san" @click="regs" >
                        <p>{{pos}}<span v-show="oo">-</span></p>
                        <p>{{city}}<span v-show="oos">-</span></p>
                        <p>{{area}}</p>              
                    </div>
                    <div class="circ" @click="clk">
                        <Icon type="arrow-up-b" class="sps" v-show="aa"></Icon>
                        <Icon type="arrow-down-b" class="sps" v-show="bb"></Icon>
                        <Icon type="close-circled" class="circs"  v-show="cc" ></Icon>     
                    </div>    
                </div>
            </div>

            <!-- <div class="fog" v-show='fog'>
                <p v-for='(item, index) in red' @click='pso(index)'>{{item.font}}</p>
            </div> -->
            
            <div class="reg-ban" v-show="ban" >
                <div v-for="(item,index) in pro" @click="cls(index)" >
                      {{item.pros}} 
                      <Icon type="chevron-right" class="oox"></Icon>                                      
                </div>                   
            </div>

            <div class="reg-bans" v-show="bana" >
                <div v-for="(item,index) in citys" @click="scls(index)">
                      {{item.lis}} 
                      <Icon type="chevron-right" class="oox"></Icon>                                         
                </div>               
            </div>

            <div class="reg-banss" v-show="banb" >
                <div v-for="(item,index) in region" @click="clss(index)">
                      {{item.reg}}                                      
                </div>                  
            </div>

            <div class="fsl-bos">
                <p class="left-left"><span class="o-red">*</span>详细地址</p>
                <textarea v-model='tea' class="trea" placeholder="建议您如实填写详细地址。例如街道名称，门牌号码，楼层和房间号等信息"></textarea>
            </div>

            <div class="fsl-bos">
                <p class="left-left"><span class="o-red">*</span>邮政编码</p>
                <input v-model='office' type="text" class="ins" placeholder="如您不清楚邮政区号，请填写000000">
            </div>

            <div class="fsl-bos">
                <p class="left-left"><span class="o-red">*</span>收货人姓名</p>
                <input v-model='name' type="text" class="ins" placeholder="长度不超过25个字符">
            </div>

            <div class="fsl-bos">
                <p class="left-left"><span class="o-red">*</span>手机号码</p>
                <input v-model='phone' type="text" class="ina" placeholder="电话号码手机号必须填一项">

                <div class="phones">
                    <span class="pps">或固定电话</span>
                    <input type="text" v-model='qu' class="inb" placeholder="区号">
                    <span>-</span>
                    <input type="text" v-model='dian' class="inc" placeholder="电话号码">
                </div>
            </div>

            <div class="fsl-bos">
                <input type="checkbox" class="mor">
                <span>设为默认收货地址</span>
                <div class="pre" @click="pre">修改</div>
            </div>

            <div class="foor-bottom">
                <div class="fs-fs">
                    <p v-for='item in req'>{{item.fon}}</p>
                </div>

                <div class="fs-os" v-for='(item, index) in arr'>
                    <p>{{item.receiverName}}</p>
                    <p>{{item.receiverArea}}</p>
                    <p>{{item.receiverAddress}}</p>
                    <p>{{item.receiverZip}}</p>
                    <div class="phs"><div>{{item.receiverMobile}}</div><div>{{item.receiverPhone}}</div></div>
                    <p><span @click='updata(index)'>修改</span>|<span @click='del(index)'>删除</span></p>
                </div>
            </div>
        </div>
    </div>

</template>

<script>

    import { Icon } from 'iview'

    import { mapState } from 'vuex'

    export default {

        components : {

            Icon,

        },

        data () {

            return {

                shoppid : [],

                qu    : '',

                dian  : '',

                tea   : '',

                name  : '',

                phone : '',

                office: '',

                ber   : 0 ,

                fog   : false,                

                bans  : false,
                
                banas : false,
                
                banbs : false,

                ban   : false,

                bana  : false,

                banb  : false,

                aa    : false,

                bb    : true ,

                cc    : false,

                oos   : false,

                fog   : false,

                oo    : false,
                
                citys : '',

                city  : '',

                area  : '',

                arr   : '',

                region: '',

                guo   : '中国大陆',
                
                pos   : '请选择省市区',

                red  : [{
                    font : '中国大陆'
                },{
                    font : '香港'
                },{
                    font : '澳门'
                }],

                req : [{
                    fon : '收货人'
                },{
                    fon : '所在地区'
                },{
                    fon : '详细地址'
                },{
                    fon : '邮编'
                },{
                    fon : '电话/手机'
                },{
                    fon : '操作'
                }],

                pro :[{             
                    pros : "广东省" ,
                    city : [{
                        lis : '广州市',
                        region : [{
                            reg : '天河区'
                        },{
                            reg : '番禺区'
                        },{
                            reg : '番禺区'
                        },{
                            reg : '番禺区'
                        },{
                            reg : '番禺区'
                        },{
                            reg : '番禺区'
                        },{
                            reg : '番禺区'
                        }]
                    },{
                        lis : '深圳市',
                        region : [{
                            reg : '宝安区'
                        },{
                            reg : '南山区'
                        }]
                    },{
                        lis : '深圳市',
                        region : [{
                            reg : '宝安区'
                        },{
                            reg : '南山区'
                        }]
                    },{
                        lis : '深圳市',
                        region : [{
                            reg : '宝安区'
                        },{
                            reg : '南山区'
                        }]
                    }]
                },{             
                    pros : "黑龙江省" ,
                    city : [{
                        lis : '大庆市',
                        region : [{
                            reg : '龙凤区'
                        },{
                            reg : '大同区'
                        }]
                    },{
                        lis : '伊春市',
                        region : [{
                            reg : '带岭区'
                        },{
                            reg : '西林区'
                        }]
                    }]
                },{             
                    pros : "黑龙江省" ,
                    city : [{
                        lis : '大庆市',
                        region : [{
                            reg : '龙凤区'
                        },{
                            reg : '大同区'
                        }]
                    },{
                        lis : '伊春市',
                        region : [{
                            reg : '带岭区'
                        },{
                            reg : '西林区'
                        }]
                    }]
                }],               
            }
            
        },

        computed : {

             ...mapState([

                'res'

            ])

        },

        watch : {

            res () {

                this.arr = this.$store.state.res
                
            }

        },

        methods : {

            //关闭弹窗
            errs () {
                
                this.pos = '请选择省市区'
                this.city = ''
                this.area = ''
                this.tea = ''
                this.office = ''
                this.name = ''
                this.phone = ''
                this.qu = ''
                this.dian = ''
                this.oo = false
                this.oos = false

                this.ban = false

                this.bana = false

                this.banb = false

                this.$store.commit('bas', false)

                setTimeout(() => {
                    this.$store.commit('bas', true)
                }, 10)

            },

            //修改收货地址信息
            async pre () {

                let blur = /^((1[3,5,8][0-9])|(14[5,7])|(17[0,6,7,8])|(19[7]))\d{8}$/

                if (this.shoppid != '') {

                    if (!blur.test(this.phone) && this.phone != '') {

                        alert('手机号格式不正确！')

                    } else {

                        let obs = this.shoppid.receiverArea.split('-')
                        let o = this.shoppid.receiverMobile.split('-')

                        if (this.guo != '') {
                            this.shoppid.receiverRegion = this.guo
                        }
                        if (this.pos != '') {
                            obs[0] = this.pos
                        }
                        if (this.city != '') {
                            obs[1] = this.city
                        }
                        if (this.area != '') {
                            obs[2] = this.area
                        }
                        if (this.tea != '') {
                            this.shoppid.receiverAddress = this.tea
                        }
                        if (this.office != '') {
                            this.shoppid.receiverZip = this.office
                        }
                        if (this.name != '') {
                            this.shoppid.receiverName = this.name
                        }
                        if (this.phone != '') {
                            this.shoppid.receiverPhone = this.phone
                        }
                        if (this.qu != '') {
                            o[0] = this.qu
                        }
                        if (this.dian != '') {
                            o[1] = this.dian
                        }

                        let posi = []
                        let poss = []

                        posi.push(o[0], o[1])
                        poss.push(obs[0], obs[1], obs[2])

                        this.listShipping = await this.$api.updateShipping({
                            id : this.shoppid.id,
                            receiverName : this.shoppid.receiverName,
                            receiverPhone : this.shoppid.receiverPhone,
                            receiverMobile : posi.join('-'),
                            receiverRegion : this.shoppid.receiverRegion,
                            receiverArea : poss.join('-'),
                            receiverAddress : this.shoppid.receiverAddress,
                            receiverZip : this.shoppid.receiverZip
                        })

                        let poso = await this.$api.listShipping()

                        this.arr = poso.data.data

                        this.$store.commit('list', poso)

                        setTimeout(() => {
                            this.$store.commit('list', poso)
                        }, 10)

                        this.shoppid = []

                        this.pos = '请选择省市区'
                        this.city = ''
                        this.area = ''
                        this.tea = ''
                        this.office = ''
                        this.name = ''
                        this.phone = ''
                        this.qu = ''
                        this.dian = ''
                        this.oo = false
                        this.oos = false
                        
                        this.ban = false

                        this.bana = false

                        this.banb = false

                        if (this.qu != '' && this.dian != '') {

                            this.$store.commit('cor', false)

                            setTimeout(() => {
                                this.$store.commit('cor', true)
                            }, 10)
                    }

                    }

                } else {

                    alert('请选择修改地址！')

                }

            },

            fogs () {

                this.fog = !this.fog

            },

            pso (index) {

                this.guo = this.red[index].font

                this.fog = false

            },

            //点击修改按钮
            updata (index) {

                this.shoppid = this.arr[index]

                let obs = this.arr[index].receiverArea.split('-')
                let reo = this.arr[index].receiverMobile.split('-')

                this.guo = this.arr[index].receiverRegion
                this.pos = obs[0]
                this.city = obs[1]
                this.area = obs[2]
                this.tea = this.arr[index].receiverAddress
                this.office = this.arr[index].receiverZip
                this.name = this.arr[index].receiverName
                this.phone = this.arr[index].receiverPhone
                this.qu = reo[0]
                this.dian = reo[1]

            },

            //点击删除按钮
            async del (index) {

                let pos = await this.$api.deleteShipping({
                    shippingId : this.arr[index].id
                })

                let poso = await this.$api.listShipping()

                this.arr = poso.data.data

                this.$store.commit('list', poso)

            },
            
            //选择省市区
            regs () {

                if (this.pos == '请选择省市区') {

                    this.ban = !this.ban

                    this.bana = false

                    this.banb = false

                    this.aa = !this.aa

                    this.bb = !this.bb

                    this.cc = false
                }
                else if ( this.area != null) {

                    this.ban = true

                    this.bana = false

                    this.banb = false

                }

            },

            //选择省市区
            cls (index) {

                this.pos = this.pro[index].pros

                this.citys = this.pro[index].city

                this.city = null

                this.area = null

                this.bana = true

                this.oos = false
               
                this.banb = false              

            },

            //选择省市区
            scls (index) {

                this.city = this.citys[index].lis

                this.area= this.citys[index].reg

                this.region = this.citys[index].region

                this.banb = true

                this.oo = true

            },

            //选择省市区
            clss (index) {

                this.area = this.region[index].reg

                this.banb = false

                this.ban = false

                this.bana = false

                this.oos = true

                this.aa = false

                this.bb = true

            },

            //选择省市区
            clk () {

                this.city = null

                this.pos = null

                this. area = null

                this.ban = false

                this.bana = false

                this.banb = false

                this.cc = false

                this.oo = false

                this.oos = false

                this.pos= "请选择省市区"

                this.bb = true

                this.banas = false

                this.bans = false

                this.banbs = false
            },

            //选择省市区
            mou () {
                
                if (this.pos != "请选择省市区" && this.city != null && this.area != null) {

                    this.cc = true

                    this.bb = false             

                }
                
            },

            les () {

                this.cc = false

                this.bb = true
            }

        },

        created () {

        },

        mounted () {

        }

    }

</script>
