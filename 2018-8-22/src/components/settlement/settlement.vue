







<style scoped>

    .sett {
        width: 100%;
        height: 100%;
        position: relative;
    }
    .sett-bottom {
        width: 100%;
        height: 100%;
        border-top: 2px solid #000;
        background: #f1f1f1;
    }
    .fsl {
        width: 1200px;
        margin: 0 auto;
        padding: 59px 0 30px;
        margin-bottom: 50px;
        background: #fff;
    }
    .fsl .ys {
        width: 100%;
        height: 28px;
        color: #999;
        background: #fffdee;
        border: 1px solid #edd491;
        margin-bottom: 35px;
        padding: 0 25px;
    }
    .ys span {
        position: relative;
        bottom: 3px;
    }
    .ys img {
        position: relative;
        top: 3px;
    }
    .qb {
        width: 100%;
    }
    .qb .oo {
        font-size: 18px;
        color: #e60012;
        padding: 0 30px 10px;
    }
    .infor {
        overflow: hidden;
        background: #f1f1f1;
    }
    .infor-top {
        height: 48px;
        font-size: 16px;
        line-height: 48px;
        background: #f2f9fe;
        padding: 0 15px;
    }
    .infor-top p {
        width: 190px;
        text-align: center;
        float: left;
    }
    .infor-top p:first-child {
        width: 344px;
        text-align: left;
        padding-left: 80px;
        margin-left: 50px;
    }
    .poo {
        overflow: hidden;
        cursor: pointer;
        margin-top: 17px;
    }
    .poo:hover {
        background: #fff4f7;
    }
    .poo-oo {
        width: 190px;
        overflow: hidden;
        padding-top: 10px;
        float: left;
    }
    .poo-oo:first-child {
        width: 409px;
        padding: 10px 0 19px 47px;
    }
    .poo-oo img {
        width: 90px;
        height: 70px;
        float: left;
    }
    .poo-oo .ps {
        width: 230px;
        float: left;
        margin-left: 10px;
    }
    .oos {
        width: 190px;
        text-align: center;
    }
    .oso p {
        text-align: center;
        margin-right: 50px;
    }
    .los {
        width: 65px;
        margin: 0 auto;
    }
    .los div {
        width: 15px;
        height: 25px;
        text-align: center;
        line-height: 25px;
        border: 1px solid #ccc;
        background: #fff;
        float: left;
        cursor: pointer;
    }
    .los input {
        width: 35px;
        height: 25px;
        text-align: center;
        border: 0;
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        outline: medium;
        padding: 0 5px;
        float: left;
    }
    .oo-one {
        text-align: center;
    }
    .mess {
        width: 1180px;
        height: 89px;
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        margin: 13px auto 0;
    }
    .mess-oo {
        width: 589px;
        height: 79px;
        border-right: 1px solid #ccc;
        margin-top: 5px;
        padding: 0 30px;
        float: left;
    }
    .mess-oo:first-child {
        font-size: 12px;
        padding-top: 15px;
    }
    .mess-oo .wl {
        width: 100%;
        height: 33px;
        border: 1px solid #ccc;
        resize: none;
        outline: medium;
        margin-top: 5px;
    }
    .mess-oo:last-child {
        border-right: 0;
    }
    .mess-oo .ls {
        font-size: 15px;
        color: #000;
    }
    .ooc {
        overflow: hidden;
        line-height: 30px;
        margin-top: 15px;
    }
    .ooc .pp {
        float: left;
        font-size: 15px;
        color: #000;
        margin-right: 5px;
    }
    .ooc img {
        float: left;
        position: relative;
        top: 4px;
        z-index: 1;
    }
    .ooc .yo {
        float: left;
        position: relative;
        top: 6px;
    }
    .mes {
        width: 315px;
        height: 30px;
        line-height: 30px;
        border: 1px solid #ccc;
        background: #fff;
        padding: 0 5px;
        float: left;
        position: relative;
        z-index: 0;
        margin-left: -1px;
    }
    .opp {
        margin: 8px 0;
        padding-left: 65px;
    }
    .opp span {
        margin-left: 15px;
    }
    .opp span:last-child {
        color: #0891fb;
    }
    .personal {
        width: 1147px;
        overflow: hidden;
        margin: 47px auto 0;
    }
    .personal .on {
        color: #e60012;
        font-size: 18px;
        margin-left: 5px;
    }
    .ons {
        color: #E7D5A8;
        font-weight: bold;
        float: right;
        line-height: 27px;
        margin-right: 16px;
        cursor: pointer;
    }
    .fso {
        margin-top: 10px;
    }
    .box-box {
        width: 1147px;
        overflow: hidden;
        padding-bottom: 10px;
        border-bottom: 1px solid #ccc;
        margin-bottom: 55px;
    }
    .fso-box {
        position: relative;
    }
    .bos {
        width: 1147px;
        overflow: hidden;
        background: #fff0e8;
        border: 1px solid #ff4400;
        margin: 0 auto;
        padding: 0 16px;
        position: absolute;
        top: 0;
    }
    .boo {
        width: 960px;
        line-height: 32px;
        position: absolute;
        left: 110px;
    }
    .boo .shou {
        margin-left: 10px;
    }
    .bos img {
        position: relative;
        top: 3px;
        float: left;
    }
    .bos .ol {
        float: left;
        color: #FF4400;
        line-height: 32px;
        font-weight: bold;
        margin: 0 10px;
    }
    .fsl-o {
        overflow: hidden;
        color: #000;
        font-size: 14px;
        font-weight: bold;
    }
    .fsl-t {
        font-size: 14px;
        margin: 0 15px;
    }
    .fsl-ss {
        float: right;
        line-height: 32px;
    }
    .fsl-s {
        font-size: 14px;
    }
    .fsl-f {
        color: #0891fb;
    }
    .non {
        width: 100%;
        overflow: hidden;
    }
    .non p {
        width: 100px;
        height: 25px;
        text-align: center;
        font-weight: bold;
        line-height: 25px;
        border: 1px solid #c9c9c9;
        border-radius: 3px;
        margin: 27px 0 0 120px;
        cursor: pointer;
    }
    .mode {
        width: 1147px;
        overflow: hidden;
        border-bottom: 1px solid #ccc;
        padding-bottom: 19px;
        margin: 0 auto 55px;
        position: relative;
    }
    .mode p {
        color: #e60012;
        font-size: 18px;
        padding: 0 5px;
    }
    .payimg {
        width: 35px;
        height: 35px;
        position: absolute;
        left: 15px;
    }
    .ho {
        width: 121px;
        height: 37px;
        line-height: 35px;
        font-size: 15px;
        border: 1px solid #ccc;
        position: relative;
        margin: 10px 10px 0 0;
        padding-left: 58px;
        float: left;
        cursor: pointer;
    }
    .payment_his {
        border: 1px solid #e60012;
    }
    .ho img {
        position: absolute;
        right: 0;
        bottom: 0;
    }
    .coupon {
        width: 1148px;
        margin: 0 auto;
    }
    .coupon-cou {
        font-size: 18px;
        color: #e60012;
        margin: 0 0 10px 5px;
    }
    .coupon-cou span {
        cursor: pointer;
    }
    .coupon-cen {
        height: 102px;
        border: 1px solid #ccc;
        margin-bottom: 50px;
    }
    .cen-o {
        height: 39px;
        line-height: 39px;
        background: #f1f1f1;
    }
    .cen-o p {
        width: 382px;
        text-align: center;
        font-size: 15px;
        font-weight: bold;
        float: left;
    }
    .cen-c {
        height: 63px;
        line-height: 63px;
    }
    .cen-c p {
        width: 382px;
        text-align: center;
        font-size: 15px;
        font-weight: bold;
        float: left;
    }
    .cen-c p:first-child {
        color: #e60012;
    }
    .cen-cen {
        width: 1149px;
        height: 175px;
        border: 1px solid #ccc;
        margin-bottom: 51px;
    }
    .kos {
        width: 382px;
        height: 100%;
        text-align: center;
        border-right: 1px solid #ccc;
        float: left;
        padding-top: 38px;
    }
    .kos:last-child {
        border-right: 0;
    }
    .ffo p {
        text-align: center;
        margin: 15px 0;
    }
    .kos .vvo {
        width: 146px;
        height: 32px;
        color: #fff;
        font-size: 14px; 
        line-height: 32px;
        background: #0085f0;
        border-radius: 5px;
        margin: 0 auto;
    }
    .kos:nth-child(2) .vvo {
        background: #00c17d;
    }
    .kos:last-child {
        text-align: right;
        padding-right: 20px;
    }
    .pp1 {
        margin-bottom: 10px;
        font-size: 18px;
    }
    .pp2 {
        font-size: 14px;
        margin-bottom: 5px;
    }
    .ppp {
        font-size: 18px;
        color: #e60012;
        margin-top: 10px;
    }
    .fsl-foor {
        width: 1147px;
        overflow: hidden;
        font-size: 15px;
        margin: 0 auto;
    }
    .fsl-foor p {
        text-align: right;
    }
    .fsl-foor .reo {
        color: #e60012;
    }
    .foor-bottom {
        float: right;
        margin-top: 15px;
    }
    .foor-bottom span {
        float: left;
        color: #e60012;
        line-height: 38px;
    }
    .foor-bottom div {
        width: 138px;
        height: 38px;
        color: #fff;
        text-align: center;
        line-height: 38px;
        border-radius: 5px;
        margin-left: 15px;
        background: #e60012;
        float: left;
        cursor: pointer;
    }
    .center-foor {
        padding-bottom: 50px;
        background: #fafafa;
    }
    .center-foor .heas {
        border-bottom: 1px solid #666;
    }
    .news-oo {
        width: 100%;
        height: 100%;
        opacity: 0.5;
        background: #000;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 998;
    }
    .news {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 999;
    }

</style>

<template>

    <div class="sett">
        <div class="sett-top">
            <order-navs></order-navs>
        </div>

        <div class="sett-bottom">
            <div class="fsl">
                <div class="ys">
                    <img src="../../../static/images/sett/1.png">
                    <span>温馨提示：请确认相关商品信息后提交订单。</span>
                </div>

                <div class="qb">
                    <div class="oo">全部商品（{{this.number}}）</div>

                    <div class="infor">
                        <div class="infor-top">
                            <div>
                                <p v-for='item in spn'>{{item.fon}}</p>
                            </div>
                        </div>
                    </div>

                    <div class="poo" v-for='item in cartlist'>
                        <div class="poo-oo">
                            <img :src="item.mainImage">
                            <p class="ps">{{item.name}}{{item.subtitle}}</p>
                        </div>

                        <div class="poo-oo">
                            <div class="oos">
                                <p>日租金：￥{{item.rent}}</p>
                            </div>

                            <div class="oos">
                                <p>押金：￥{{item.price}}</p>
                            </div>
                        </div>

                        <div class="poo-oo">
                            <p class="oo-one">{{item.quantity}}</p>
                        </div>

                        <div class="poo-oo">
                            <p class="oo-one">1期</p>
                        </div>

                        <div class="poo-oo">
                            <p class="oo-one">租金小计：￥{{item.totalRent}}</p>
                            <p class="oo-one">总押金：￥{{item.totalPrice}}</p>
                        </div>
                    </div>

                    <div class="mess">
                        <div class="mess-oo">
                            <p class="ls">我的留言：</p>
                            <textarea class="wl" v-model='message'></textarea>
                        </div>

                        <div class="mess-oo">
                            <div class="ooc">
                                <span class="pp">发票信息</span>
                                <img class="yo" src="../../../static/images/sett/2.png">
                                <div class="mes">
                                    <img src="../../../static/images/sett/1.png">
                                    <span>开企业抬头发票须填写纳税人识别号，以免影响报销</span>
                                </div>
                            </div>

                            <div class="opp">
                                <span>不开发票</span>
                                <span>修改</span>
                            </div>
                        </div>
                    </div>

                    <div class="personal">
                        <div>
                            <span class="on">收货人信息</span>
                            <span class="ons" @click='admins'>管理收货地址</span>
                        </div>

                        <div class="fso">
                            <div class="box-box">
                                <div class="fso-box">
                                    <RadioGroup vertical @on-change='lis' size='large'>
                                        <Radio :label="index" v-for='(item, index) in res' :key='index' size='large'>
                                            <div class="bos" v-show='bo == index'>
                                                <img src="../../../static/images/sett/3.png">
                                                <span class="ol">寄送至</span>
                                                <div class="fsl-ss">
                                                    <span class="fsl-f" @click='modify(index)'>修改本地址</span>
                                                </div>
                                            </div>

                                            <span class="boo" @click='oo(index)'>
                                                <span class="fsl-o">{{item.receiverArea}}
                                                    （{{item.receiverName}}<span class="shou">收</span>）
                                                </span>
                                                <span class="fsl-t">{{item.receiverPhone || item.receiverMobile}}</span>
                                                <!-- <span class="fsl-s" v-show='bo == index'>默认地址</span> -->
                                            </span>
                                        </Radio>
                                    </RadioGroup>
                                </div>

                                <div class="non">
                                    <p @click='news'>+使用新地址</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mode">
                        <p>支付方式：</p>
                        <div class="ho" :class="{'payment_his': payh == index}" v-for='(item, index) in payment' @click='payment_s(index)'>
                            <div>
                                <img class="payimg" :src="item.imo">
                                <span>{{item.payments}}</span>
                            </div>

                            <img :src="item.img" v-show='payh == index'>
                        </div>
                    </div>

                    <div class="coupon">
                        <div class="coupon-cou">
                            <span @click='cou'>使用优惠券∨</span>
                        </div>

                        <div class="coupon-cen" v-show='ooo'>
                            <div class="cen-o">
                                <p>优惠券金额</p>
                                <p>使用条件</p>
                                <p>有效期</p>
                            </div>

                            <div class="cen-c">
                                <p>60元</p>
                                <p>满1000元立即使用</p>
                                <p>2018.6.21-2018.6.22</p>
                            </div>
                        </div>

                        <div class="cen-cen">
                            <div class="kos ffo">
                                <img src="../../../static/images/sett/zm.png">
                                <p>开通芝麻企业信用分，累积企业信用，有机会享有更高免押金额度。</p>
                                <div class="vvo">开通芝麻企业信用分</div>
                            </div>

                            <div class="kos ffo">
                                <img src="../../../static/images/sett/zx.png">
                                <p>有中国人民银行征信中心出具的记载个人信用信息的记录。</p>
                                <div class="vvo">开通征信企业信用分</div>
                            </div>

                            <div class="kos">
                                <p class="pp1">商品总压金：￥{{this.totalPrice}}</p>

                                <p class="pp2">
                                    <span>减免押金：-￥0.00</span>
                                    <span>应付租金：￥{{this.totalRent}}</span>
                                </p>

                                <p class="pp2">
                                    <span>增值服务：￥0</span>
                                    <span>优惠金额：￥0.00</span>
                                    <span>运费：￥0.00</span>
                                </p>

                                <p class="ppp">实付金额：￥{{this.Realpayment}}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="fsl-foor">
                    <p>
                        <input type="checkbox">
                        <span>同意</span>
                        <span class="reo"><<广租电脑设备租赁协议>></span>
                    </p>

                    <div class="foor-bottom">
                        <span><返回我的租赁箱修改</span>
                        <div @click='sub'>提交订单</div>
                    </div>
                </div>
            </div>

            <div class="center-foor">
                <div class="heas">
                    <tail-hear></tail-hear>
                </div>

                <tail-foor></tail-foor>
            </div>
        </div>

        <div class="news-oo" v-show='mod'></div>
        <news-model class="news" v-show='modo'></news-model>
        <modify-model class="news" v-show='modt'></modify-model>
        <admins-model class="news" v-show='mods'></admins-model>
    </div>

</template>

<script>

    import orderNavs   from '@/components/public/order-navs.vue'
    import tailHear    from '@/components/public/tail-hear.vue'
    import tailFoor    from '@/components/public/tail-foor.vue'
    import newsModel   from '@/components/settlement/index/news-model.vue'
    import modifyModel from '@/components/settlement/index/modify-model.vue'
    import adminsModel from '@/components/settlement/index/admins-model.vue'

    import { RadioGroup, Radio, DatePicker } from 'iview'

    import { mapState } from 'vuex'

    export default {

        components : {

            orderNavs,
            Radio    ,
            RadioGroup: Radio.Group,
            tailHear ,
            tailFoor ,
            DatePicker,
            newsModel,
            modifyModel,
            adminsModel,

        },

        data () {

            return {

                totalRent : 0,

                totalPrice : 0,

                Realpayment : 0,

                leas : '',

                number : 0,

                message : '',

                index_o : 0,

                payh : 0,

                cartlist : [],

                payment : [{
                    payments : '支付宝',
                    img : '../../../static/images/sett/4.png',
                    imo : '../../../static/images/sett/333-2.png'

                },{
                    payments : '微信',
                    img : '../../../static/images/sett/4.png',
                    imo : '../../../static/images/sett/333-3.png'

                },{
                    payments : '银行卡',
                    img : '../../../static/images/sett/4.png',
                    imo : '../../../static/images/sett/yinlian.png'

                }],

                spn : [{
                    fon : '商品信息'
                },{
                    fon : '单价（元/台/月）'
                },{
                    fon : '数量'
                },{
                    fon : '首付期数'
                },{
                    fon : '小计'
                }],

                ooo : false,

                bo   : false,

                res  : [],

                fis  : '',

                mod  : false,

                modo : false,

                modt : false,

                mods : false,

                hoo  : []

            }
            
        },

        computed : {

             ...mapState([

                'bas',
                'list',

            ])

        },

        watch : {

            bas () {

                this.mod = false

                this.modo = false

                this.modt = false

                this.mods = false
                
            },

            list () {

                this.res = this.$store.state.list.data.data

            }

        },

        methods : {

            //选择支付方式
            payment_s (index) {

                this.payh = index

                this.$store.commit('payment', this.payment[index].payments)

            },

            cou () {

                this.ooo = !this.ooo

            },

            lis (index) {

                this.bo = this.fis

                this.index_o = index

            },

            oo (index) {

                this.fis = index

            },

            news () {

                this.mod = true

                this.modo = true

            },

            admins () {

                this.mod = true

                this.mods = true

                this.$store.commit('res', this.res)

            },

            async modify (index) {

                let pos = await this.$api.selectShipping({
                    shippingId : this.res[index].id
                })

                this.mod = true

                this.modt = true

                this.$store.commit('reo', pos)
                
                setTimeout(() => {
                    this.$store.commit('reo', pos)
                }, 10)

            },

            async sub () {

                if (this.res != '') {

                    let productIds = ''

                    let numbers = ''

                    let quantitys = ''

                    if (this.leas == 1) {

                        productIds = ''

                        numbers = ''

                        quantitys = ''

                    } else {

                        productIds = this.leas[0].productId

                        numbers = this.leas[0].number

                        quantitys = this.leas[0].quantity

                    }

                    let reo = await this.$api.create({
                        shippingId : this.res[this.index_o].id,
                        message : this.message,
                        productId : productIds,
                        number : numbers,
                        quantity : quantitys
                    })

                    if (this.payh == 0) {

                        let alipay = await this.$api.alipay({
                            orderNo : reo.data.data
                        })

                        window.location.href = 'http://120.78.142.125/dg/order/alipay.do?orderNo=' + reo.data.data

                    }

                    if (this.payh == 2) {
                        
                        let res = await this.$api.unionPay({
                            orderNo : reo.data.data
                        })

                        window.location.href = 'http://120.78.142.125/dg/union/unionPay.do?orderNo=' + reo.data.data

                        // window.location.href = 'http://192.168.1.130:8080/dg/union/unionPay.do?orderNo=' + reo.data.data

                    }

                }

            },

            async lists () {

                let pos = await this.$api.listShipping()

                this.res = pos.data.data

            },

            async settList () {

                let res = await this.$api.cartList()

                let arrs = []

                for (let i in res.data.data.cartProductVoList) {

                    if (res.data.data.cartProductVoList[i].checked == 1) {

                        arrs.push(res.data.data.cartProductVoList[i])

                    }

                }

                this.leas = this.$store.state.immediately.cartProductVoList

                if (this.leas != '') {

                    this.cartlist = this.leas

                    this.Realpayment = this.$store.state.immediately.cartTotalPrice

                    this.totalPrice = this.$store.state.immediately.cartTotalDeposit

                    this.totalRent = this.$store.state.immediately.cartTotalRent

                }

                if (this.$route.query.cart == 1) {

                    this.leas = 1

                    this.cartlist = arrs

                    this.Realpayment = res.data.data.cartTotalPrice

                    this.totalPrice = res.data.data.cartTotalDeposit

                    this.totalRent = res.data.data.cartTotalRent

                    if (this.cartlist == '') {

                        this.$router.back(-1)

                    }

                }

                if (this.leas == undefined) {

                    this.$router.back(-1)
        
                } else {

                    this.number = this.cartlist.length

                }

            }

        },

        created () {

            this.oo()

            this.lists()

            this.settList()

        },

        mounted () {

        }

    }

</script>
